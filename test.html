<!DOCTYPE html>
<html>
<head>
    <script src="./phaser-3.23.0/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>
    <script src="./scripts/loading.js"></script>
    <script src="./scripts/statemachine.js"></script>
	<script src="./scripts/UI.js"></script>
    <script>
	var newKilled = -1;
    var config = {
        type: Phaser.AUTO,
        width: 1320,
        height: 1320,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
				//debug: true
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        },
    };

    var game = new Phaser.Game(config);
	
	class Monster
	{
		constructor(x, y, scene, texture)
		{
			this.body = scene.physics.add.sprite(x,y, texture);
			this.body.setVelocity(0, 0);
			this.body.setOrigin(0, 0);
			this.body.setCollideWorldBounds(true); 
			this.body.anims.play(texture+'-idle', true);
			this.healthbar = new HealthBar(scene, this);
			this.health = 100;
			this.status = 1;
			this.direction = 0;
			this.stateMachine = new StateMachine('idle', {idle: new MonsterIdleState(), chasing: new MonsterChasingState(), running: new MonsterRunState(), dead: new MonsterDeadState()}, [scene, this]); 
			
		}
		minusHealth()
		{
			this.health -= 10;
		}
		hideHealthbar(check)
		{
			if(check)
			{
				this.healthbar.background.setVisible(false);
				this.healthbar.gauge.setVisible(false);
			}
			else
			{
				this.healthbar.background.setVisible(true);
				this.healthbar.gauge.setVisible(true);
			}
		}
	}
		
	class Player
	{
		constructor(x, y, scene)
		{
			this.body = scene.physics.add.sprite(x, y, 'character_anim');
			this.HITBOX = scene.physics.add.sprite(x, y, null);
			this.HITBOX.setOrigin(0, 0);
			this.HITBOX.setVisible(false);
			this.body.setOrigin(0, 0);
			this.body.setDebug(true, true, '0xDDF3F5');
			this.health = 333;
			this.stateMachine = new StateMachine('idle', {idle: new IdleState(), move: new MoveState(), swing: new SwingState()}, [scene, this]); 
		}
	}
		
    function preload ()
    {
        loadImages(this);
    }

    function create ()
    {
		this.actingQueue = [];
		createUI(this);
		loadAnimation(this);
		loadMap(this);
		loadObjects(this);
		this.health = 333;
        this.keys = this.input.keyboard.addKeys('A, D, W, S, SPACE');
		this.cameras.main.setSize(1320, 700);
		this.cameras.main.startFollow(this.player.body, true);
        //this.stateMachine = new StateMachine('idle', {idle: new IdleState(), move: new MoveState(), swing: new SwingState()}, [this, this.player]); 
    }

    function update()
    {
		this.player.stateMachine.step();
		console.log(this.monsterlist.length);
		for(var i = 0; i<this.monsterlist.length; i++)
		{
			this.monsterlist[i].stateMachine.step();
		}
		
		/*
		console.log(this.actingQueue.length);
		if(this.actingQueue.length != 0)
		{
			this.actingQueue[0].stateMachine.step();
			this.actingQueue.shift();
		}
		*/
    }
    </script>
</body>
</html>
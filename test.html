<!DOCTYPE html>
<html>
<head>
    <script src="./phaser-3.23.0/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>
    <script src="./scripts/loading.js"></script>
    <script src="./scripts/statemachine.js"></script>
	<script src="./scripts/UI.js"></script>
    <script>
    var config = {
        type: Phaser.AUTO,
        width: 1320,
        height: 1320,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 }
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);
	
	class Monster
	{
		constructor(x, y, scene, texture)
		{
			this.body = scene.physics.add.sprite(x,y, texture);
			this.body.setVelocity(0, 0);
			this.body.setOrigin(0, 0);
			this.body.setCollideWorldBounds(true); 
			this.body.anims.play(texture+'-idle', true);
			this.healthbar = scene.add.sprite(x+this.body.width/2-47,y-15, 'monsterhealthbar');
			this.healthbar.setOrigin(0,0);
			this.health = 100;
			this.gauge = scene.add.graphics({x:x+this.body.width/2-47+90, y:y-13});
			this.gauge.fillStyle('0xDDF3F5', 1);
			this.status = 1;
		}
		minusHealth()
		{
			this.health -= 10;
		}
	}
		
	class Player
	{
		constructor(x, y, scene)
		{
			this.body = scene.physics.add.sprite(x, y, 'greenmonster');
			this.body.setOrigin(0, 0);
			this.health = 333;
		}
	}
		
    function preload ()
    {
        loadImages(this);
    }

    function create ()
    {
		createUI(this);
		loadAnimation(this);
		loadMap(this);
		loadObjects(this);
		this.health = 333;
        this.keys = this.input.keyboard.addKeys('A, D, W, S, SPACE');
        this.stateMachine = new StateMachine('idle', {idle: new IdleState(), move: new MoveState(), swing: new SwingState(),}, [this, this.player]); 
    }

    function update()
    {
        this.stateMachine.step();
		for(var i = 0; i<this.monsterlist.length; i++)
		{
			this.monsterlist[i].healthbar.setX(this.monsterlist[i].body.x+this.monsterlist[i].body.width/2-47);
			this.monsterlist[i].gauge.setX(this.monsterlist[i].body.x+this.monsterlist[i].body.width/2-47+90);
			this.monsterlist[i].healthbar.setY(this.monsterlist[i].body.y-15);
			this.monsterlist[i].gauge.setY(this.monsterlist[i].body.y-13);			
		}
    }
    </script>
</body>
</html>